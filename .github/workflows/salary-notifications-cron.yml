name: üí∞ Salary Forecast - Send Notifications

on:
  schedule:
    # Ex√©cute chaque jour √† 9h (UTC)
    # Syntaxe cron: minute heure jour mois jour_semaine
    - cron: '0 9 * * *'
  
  # Permet de d√©clencher manuellement
  workflow_dispatch:

jobs:
  send-notifications:
    runs-on: ubuntu-latest
    
    steps:
      - name: üìã R√©cup√©rer le code
        uses: actions/checkout@v4
      
      - name: üåê Appeler l'endpoint du cron job
        run: |
          curl -X GET '${{ secrets.APP_URL }}/api/cron/salary-notifications' \
            -H 'Authorization: Bearer ${{ secrets.CRON_SECRET }}' \
            -H 'Content-Type: application/json' \
            -w '\nStatus: %{http_code}\n'
        env:
          CURL_RETRIES: 3
      
      - name: ‚úÖ Notification de succ√®s
        if: success()
        run: echo "‚úÖ Notifications de salaire envoy√©es avec succ√®s"
      
      - name: ‚ùå Notification d'erreur
        if: failure()
        run: echo "‚ùå Erreur lors de l'envoi des notifications"

  # Job optionnel: V√©rifier la sant√© du syst√®me
  health-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: üè• V√©rifier que l'API est accessible
        run: |
          curl -X GET '${{ secrets.APP_URL }}/api/employees' \
            -w '\nStatus: %{http_code}\n'
        continue-on-error: true
