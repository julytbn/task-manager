generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id               String           @id @default(cuid())
  nom              String
  prenom           String
  email            String?
  telephone        String?
  entreprise       String?
  adresse          String?
  type             TypeClient       @default(PARTICULIER)
  dateNaissance    DateTime?
  dateCreation     DateTime         @default(now())
  dateModification DateTime         @updatedAt
  abonnements      Abonnement[]
  documents        DocumentClient[]
  factures         Facture[]
  paiements        Paiement[]
  projets          Projet[]
  souhaits         Souhait[]

  @@map("clients")
}

model DocumentClient {
  id          String   @id @default(cuid())
  nom         String
  description String?
  type        String?
  url         String
  clientId    String
  taille      Float?
  dateUpload  DateTime @default(now())
  uploadPar   String?
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("documents_clients")
}

model DocumentTache {
  id          String   @id @default(cuid())
  nom         String
  description String?
  type        String?
  url         String
  tacheId     String
  taille      Float?
  dateUpload  DateTime @default(now())
  uploadPar   String?
  tache       Tache    @relation(fields: [tacheId], references: [id], onDelete: Cascade)

  @@map("documents_taches")
}

model Service {
  id               String           @id @default(cuid())
  nom              String           @unique
  description      String?
  categorie        CategorieService
  prix             Float?
  dureeEstimee     Int?
  dateCreation     DateTime         @default(now())
  dateModification DateTime         @updatedAt
  abonnements      Abonnement[]
  projets          Projet[]
  taches           Tache[]
  factures         Facture[]

  @@map("services")
}

model Abonnement {
  id                       String            @id @default(cuid())
  nom                      String
  description              String?
  clientId                 String
  serviceId                String
  montant                  Float
  frequence                FrequencePaiement @default(MENSUEL)
  statut                   StatutAbonnement  @default(ACTIF)
  dateDebut                DateTime
  dateFin                  DateTime?
  dateProchainFacture      DateTime
  dernierPaiement          DateTime?
  notificationEnvoyee      Boolean           @default(false)
  nombrePaiementsEffectues Int               @default(0)
  dateCreation             DateTime          @default(now())
  dateModification         DateTime          @updatedAt
  client                   Client            @relation(fields: [clientId], references: [id])
  service                  Service           @relation(fields: [serviceId], references: [id])
  factures                 Facture[]

  @@map("abonnements")
}

model Projet {
  id                String            @id @default(cuid())
  titre             String
  description       String?
  clientId          String
  serviceId         String
  statut            StatutProjet      @default(EN_COURS)
  budget            Float?
  dateDebut         DateTime?
  dateFin           DateTime?
  dateEcheance      DateTime?
  dateCreation      DateTime          @default(now())
  dateModification  DateTime          @updatedAt
  equipeId          String?
  montantEstime     Float?
  frequencePaiement FrequencePaiement @default(PONCTUEL)
  factures          Facture[]
  paiements         Paiement[]        @relation("PaiementsDuProjet")
  client            Client            @relation(fields: [clientId], references: [id])
  equipe            Equipe?           @relation("ProjetAEquipe", fields: [equipeId], references: [id])
  service           Service           @relation(fields: [serviceId], references: [id])
  taches            Tache[]

  @@map("projets")
}

model Tache {
  id               String          @id @default(cuid())
  titre            String
  description      String?
  projetId         String
  serviceId        String?
  assigneAId       String?
  statut           StatutTache     @default(A_FAIRE)
  priorite         Priorite        @default(MOYENNE)
  dateEcheance     DateTime?
  heuresEstimees   Float?
  heuresReelles    Float?
  facturable       Boolean         @default(true)
  estPayee         Boolean         @default(false)
  montant          Float?
  dateCreation     DateTime        @default(now())
  dateModification DateTime        @updatedAt
  factureId        String?
  equipeId         String?
  commentaire      String?
  DocumentTache    DocumentTache[]
  paiements        Paiement[]
  assigneA         Utilisateur?    @relation(fields: [assigneAId], references: [id])
  equipe           Equipe?         @relation("TacheEquipe", fields: [equipeId], references: [id])
  facture          Facture?        @relation(fields: [factureId], references: [id])
  projet           Projet          @relation(fields: [projetId], references: [id])
  service          Service?        @relation(fields: [serviceId], references: [id])

  @@map("taches")
}

model TacheToDocumentTache {
  tacheId String
  docId   String

  @@id([tacheId, docId])
  @@map("_tache_to_document_tache")
}

model Facture {
  id               String        @id @default(cuid())
  numero           String        @unique
  clientId         String
  projetId         String?
  serviceId        String?
  statut           StatutFacture @default(EN_ATTENTE)
  montant          Float
  tauxTVA          Float         @default(0.18)
  montantTotal     Float
  dateEmission     DateTime      @default(now())
  dateEcheance     DateTime?
  datePaiement     DateTime?
  notes            String?
  dateCreation     DateTime      @default(now())
  dateModification DateTime      @updatedAt
  abonnementId     String?
  abonnement       Abonnement?   @relation(fields: [abonnementId], references: [id])
  client           Client        @relation(fields: [clientId], references: [id])
  projet           Projet?       @relation(fields: [projetId], references: [id])
  service          Service?      @relation(fields: [serviceId], references: [id])
  paiements        Paiement[]
  taches           Tache[]

  @@unique([abonnementId, dateEmission])
  @@map("factures")
}

model Paiement {
  id                  String         @id @default(cuid())
  tacheId             String?
  projetId            String?
  clientId            String
  factureId           String
  montant             Float
  moyenPaiement       MoyenPaiement
  reference           String?
  datePaiement        DateTime       @default(now())
  dateReception       DateTime?
  statut              StatutPaiement @default(EN_ATTENTE)
  notes               String?
  preuvePaiement      String?
  dateCreation        DateTime       @default(now())
  dateModification    DateTime       @updatedAt
  datePaiementAttendu DateTime?
  notificationEnvoyee Boolean        @default(false)
  client              Client         @relation(fields: [clientId], references: [id])
  facture             Facture        @relation(fields: [factureId], references: [id])
  projet              Projet?        @relation("PaiementsDuProjet", fields: [projetId], references: [id])
  tache               Tache?         @relation(fields: [tacheId], references: [id])

  @@map("paiements")
}

model Utilisateur {
  id                   String          @id @default(cuid())
  nom                  String
  prenom               String
  email                String          @unique
  telephone            String?
  role                 RoleUtilisateur @default(EMPLOYE)
  departement          String?
  actif                Boolean         @default(true)
  dateNaissance        DateTime?
  motDePasse           String?
  emailVerifie         DateTime?
  dateCreation         DateTime        @default(now())
  dateModification     DateTime        @updatedAt
  resetPasswordExpires DateTime?
  resetPasswordToken   String?         @unique
  equipesLead          Equipe[]        @relation("EquipeLeader")
  membresEquipes       MembreEquipe[]
  notifications        Notification[]
  souhaits             Souhait[]
  taches               Tache[]

  @@map("utilisateurs")
}

model Equipe {
  id               String         @id @default(cuid())
  nom              String
  description      String?
  objectifs        String?
  dateEcheance     DateTime?
  leadId           String?
  dateCreation     DateTime       @default(now())
  dateModification DateTime       @updatedAt
  lead             Utilisateur?   @relation("EquipeLeader", fields: [leadId], references: [id])
  membres          MembreEquipe[]
  projets          Projet[]       @relation("ProjetAEquipe")
  taches           Tache[]        @relation("TacheEquipe")

  @@map("equipes")
}

model MembreEquipe {
  id            String      @id @default(cuid())
  equipeId      String
  utilisateurId String
  role          String?
  dateAjout     DateTime    @default(now())
  equipe        Equipe      @relation(fields: [equipeId], references: [id], onDelete: Cascade)
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([equipeId, utilisateurId])
  @@map("membres_equipes")
}

model Notification {
  id               String           @id @default(cuid())
  utilisateurId    String
  titre            String
  message          String
  type             TypeNotification @default(INFO)
  lien             String?
  lu               Boolean          @default(false)
  dateCreation     DateTime         @default(now())
  dateModification DateTime         @updatedAt
  sourceId         String?
  sourceType       String?
  utilisateur      Utilisateur      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([sourceId, utilisateurId, type])
  @@map("notifications")
}

model Souhait {
  id            String       @id @default(cuid())
  type          TypeSouhait
  message       String
  clientId      String?
  utilisateurId String?
  dateEnvoi     DateTime     @default(now())
  envoye        Boolean      @default(false)
  dateCreation  DateTime     @default(now())
  destinataire  Client?      @relation(fields: [clientId], references: [id])
  employe       Utilisateur? @relation(fields: [utilisateurId], references: [id])

  @@map("souhaits")
}

model EnumStatutTache {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_statuts_taches")
}

model EnumPriorite {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_priorites")
}

model EnumStatutProjet {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_statuts_projets")
}

model EnumCategorieService {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_categories_services")
}

model EnumTypeClient {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_types_clients")
}

model EnumStatutFacture {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_statuts_factures")
}

model EnumStatutPaiement {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_statuts_paiements")
}

model EnumMoyenPaiement {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_moyens_paiement")
}

model EnumTypeNotification {
  id    String  @id @default(cuid())
  cle   String  @unique
  label String
  ordre Int     @default(0)
  actif Boolean @default(true)

  @@map("enum_types_notifications")
}

enum TypeClient {
  PARTICULIER
  ENTREPRISE
  ORGANISATION
}

enum CategorieService {
  COMPTABILITE
  AUDIT_FISCALITE
  MARKETING
  COMMUNICATION
  REDACTION_GESTION_PROJET
  DEMARRAGE_ADMINISTRATIF
  FORMATION
  COACHING
  ETUDE_MARCHE
  CONCEPTION_IMPRESSION
  IMMOBILIER
}

enum StatutProjet {
  PROPOSITION
  EN_ATTENTE
  EN_COURS
  TERMINE
  EN_RETARD
  ANNULE
}

enum StatutTache {
  A_FAIRE
  EN_COURS
  EN_REVISION
  TERMINE
  ANNULE
}

enum Priorite {
  BASSE
  MOYENNE
  HAUTE
  URGENTE
}

enum StatutFacture {
  BROUILLON
  EN_ATTENTE
  PARTIELLEMENT_PAYEE
  PAYEE
  RETARD
  ANNULEE
}

enum StatutPaiement {
  EN_ATTENTE
  CONFIRME
  REFUSE
  REMBOURSE
}

enum MoyenPaiement {
  ESPECES
  CHEQUE
  VIREMENT_BANCAIRE
  CARTE_BANCAIRE
  MOBILE_MONEY
  PAYPAL
  AUTRE
}

enum RoleUtilisateur {
  ADMIN
  MANAGER
  EMPLOYE
  CONSULTANT
}

enum TypeSouhait {
  ANNIVERSAIRE
  BONNE_ANNEE
  FETE
  AUTRE
}

enum TypeNotification {
  INFO
  EQUIPE
  TACHE
  ALERTE
  SUCCES
}

enum FrequencePaiement {
  PONCTUEL
  MENSUEL
  TRIMESTRIEL
  SEMESTRIEL
  ANNUEL
}

enum StatutAbonnement {
  ACTIF
  SUSPENDU
  EN_RETARD
  ANNULE
  TERMINE
}
